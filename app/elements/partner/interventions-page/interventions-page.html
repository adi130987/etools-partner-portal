
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../common/etools-ajax/etools-ajax.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../../behaviors/common/utils.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <my-customel></my-customel>

@group Seed Elements
@element my-customel
@demo demo/index.html
@hero hero.svg
-->
<dom-module id="interventions-page">

  <template>
    <style>
      :host {
        display: block;
      }
      iron-list {
        padding-top: 1px;
        padding-bottom: 16px;
        -webkit-flex: 1 1;
        flex: 1 1;
        --iron-list-items-container: {
          max-width: 800px;
          margin: auto;
          margin-top: 60px;
          margin-bottom: 60px;
          border-bottom: 1px solid #ddd;
        };
      }
      .item {
        @apply(--layout-horizontal);
        padding: 20px;
        background-color: white;
        border: 1px solid #ddd;
        cursor: pointer;
        margin-bottom: 10px;
      }
      .pad {
        padding: 0 16px;
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }
      .primary {
        font-size: 16px;
        font-weight: bold;
      }
      .shortText, .longText {
        font-size: 14px;
      }
      .spacer {
        @apply(--layout-flex);
      }
      .item-body{
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }
      .item-icon {
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }
    </style>
    <div> These are your current interventions: </div>
    
    <etools-ajax
          auto
          id="ajax"
          url="[[url]]"
          handle-as="json"
          on-response="handleResponse"
          debounce-duration="300">
    </etools-ajax>

    <iron-list id="list" items="[[interventions]]" as="item">
        <template>
            <div class="item"  on-tap="_goToIntervention" tabindex="0">
                <div class="pad">
                  
                  <div class="primary">[[item.title]]</div>
                  
                  
                  <div class="shortText">
                    <p>Status: [[underscoreless(item.status)]]</p>
                    <p>Ending: [[dateFormat(item.end_date, 'LL')]]</p>
                  </div>

                </div>
                <iron-icon icon="icons:chevron-right"></iron-icon>
            </div>
        </template>
    </iron-list>
   
     

  </template>

</dom-module>

<script>
(function() {
    // jscs:disable
  'use strict';
  Polymer({
    is: 'interventions-page',
    behaviors: [commonBv.utils],
    properties: {
      appData: {
        type: Object,
        // appData is received from the parent
        value: {}
      },
      interventions: {
        type: Array,
        notify: true,
        value: []
      },
      url: {
        type: String,
        value: null
      }
    },
    ready: function(){
      this.url = this.appData.interventionsEp;
    },

    handleResponse: function(rsp) {
      this.interventions = rsp.detail.xhr.response;
    },

    _goToIntervention: function(e){
      page(this.appData.baseUrl+'intervention/' + e.model.item.id+'/');
    },
    _collapseExpand: function(e) {
      var list = this.$.list;
      var index = e.model.index;
      var isExpanded = list.items[index].expanded;
      list.set('items.' + index + '.expanded', !isExpanded);
      list.updateSizeForItem(e.model.index);
    }
  });
})();

</script>