
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../common/etools-ajax/etools-ajax.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-list/iron-list.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <my-customel></my-customel>

@group Seed Elements
@element my-customel
@demo demo/index.html
@hero hero.svg
-->
<dom-module id="interventions-page">

  <template>
    <style>
      :host {
        display: block;
      }
      iron-list {
        padding-top: 1px;
        padding-bottom: 16px;
        -webkit-flex: 1 1;
        flex: 1 1;
        --iron-list-items-container: {
          max-width: 800px;
          margin: auto;
          margin-top: 60px;
          margin-bottom: 60px;
          border-bottom: 1px solid #ddd;
        };
      }
      .item {
        @apply(--layout-horizontal);
        padding: 20px;
        background-color: white;
        border: 1px solid #ddd;
        cursor: pointer;
        margin-bottom: 10px;
      }
      .item:focus {
        outline: 0;
        border-color: #666;
      }
      .avatar {
        height: 40px;
        width: 40px;
        border-radius: 20px;
        box-sizing: border-box;
        background-color: #DDD;
      }
      .pad {
        padding: 0 16px;
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }
      .primary {
        font-size: 16px;
        font-weight: bold;
      }
      .shortText, .longText {
        font-size: 14px;
      }
      .longText {
        color: gray;
        display: none;
      }
      .item:hover .shortText::after {
        /*content: ' [+]';*/
        color: gray;
      }
      .item.expanded:hover .shortText::after {
        /*content: '';*/
      }
      .item.expanded .longText {
        display: block;
      }
      .item.expanded:hover .longText::after {
        /*content: ' [â€“]';*/
      }
      .spacer {
        @apply(--layout-flex);
      }
      .item-body{
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }
      .item-icon {
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }
    </style>
    <div> These are your current interventions: </div>
    
    <etools-ajax
          auto
          id="ajax"
          url="[[url]]"
          handle-as="json"
          on-response="handleResponse"
          debounce-duration="300">
    </etools-ajax>

    <iron-list id="list" items="[[interventions]]" as="item">
        <template>
            <div class="item" class$="[[getClassForItem(item, item.expanded)]]" on-tap="_goToIntervention" tabindex="0">
                <div class="pad">
                  <a hresf$="{{appData.baseUrl}}intervention/1">
                    <div class="primary">[[item.title]]</div>
                  </a>
                  
                  <div class="shortText">Intervention Details</div>
                  <div class="longText"></div>

                </div>
                <iron-icon icon="icons:chevron-right"></iron-icon>
            </div>
            
        </template>
    </iron-list>
   
     

  </template>

</dom-module>




<script>
(function() {
    // jscs:disable
  'use strict';
  Polymer({
    is: 'interventions-page',
    properties: {
      appData: {
        type: Object,
        // appData is received from the parent
        value: {}
      },
      interventions: {
        type: Array,
        notify: true,
        value: []
      },
      url: {
        type: String,
        value: null
      }
    },
    ready: function(){
      this.url = this.appData.interventionsEp;
    },

    handleResponse: function(rsp) {
      this.interventions = rsp.detail.xhr.response;
    },

    _goToIntervention: function(e){
      console.log(e.model.item);
      console.log(this.appData.baseUrl+'intervention/' + e.model.item.id+'/');
      
      page(this.appData.baseUrl+'intervention/' + e.model.item.id);

    },
    _collapseExpand: function(e) {
      var list = this.$.list;
      var index = e.model.index;
      var isExpanded = list.items[index].expanded;
      list.set('items.' + index + '.expanded', !isExpanded);
      list.updateSizeForItem(e.model.index);
    },
    iconForItem: function(item) {
      return item ? (item.integer < 50 ? 'star-border' : 'star') : '';
    },
    getClassForItem: function(item, expanded) {
      return expanded ? 'item expanded' : 'item';
    }
  });
})();

</script>